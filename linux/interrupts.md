# Interrupts and Exceptions

## Intro
* Interrupts are events that alter the sequence of instructions executed by a processor.
* Correspond to electrical signals generated by hardware circuits inside and outside CPU chip
* Synchronous interrupts
    * Produced by CPU control unit
    * Control unit issues them only after terminating the execution of an instruction
    * Also called exception
    * Triggered by programming errors or odd conditions 
    * The kernel will need to handle these cases.
        * Programming errors: delivers a signal to the process
        * Odd condition: kernel tries to recover via steps like page fault or some assembly instruction
* Asynchronous interrupts
    * Generated by hardware devices at arbitrary times with respect to CPU clock signals
    * Also called interrupts
    * Issued by interval timers and I/O devices
        * i.e a keystroke

## Interrupt Signals

### Basics
* Signals provide a way to divert processor to code outside the normal flow of control
* Flow
    * Interrupt arrives
    * CPU stops current activities
    * Save current value of the program counter in the kernel mode stack
    * Place address related to interrupt type into program counter
    * Switch to new activity
* Similar to context switch, but not really
    * Key difference: code executed by an interrupt/exception handler is not a process
    * Interrupt handler is much ligher than process
* Extremely sensitive operation
    * Interrupts can occur anytime
        * Kernel wants to handle as quickly as possible
        * Usually leads to split handling of urgent part and deferrable part
            * Example is getting a block of data from network line
            * Put the network data into some buffer. Just put it in a place the process can find it.
            * Let the recipient handle how to deal with it.
    * Kernel might be handling one signal while another signal arrives
        * Allow this to occur b/c it keeps I/O devices busy
        * Interrupt handlers need to be coded so kernel control paths can be executed in a nested manner
        * Kernel needs to be able to resume execution of interrupted proecss or switch
    * Critical areas exist in kernel where interrupts must be disabled
        * Need to limit the number of these critical regions
        * Kernel needs to run with interrupts enabled most of the time

## Interrupts and Exceptions

### Basics
* Intel has its own definition of interrupts + exceptions
* Interrupts
    * Maskable interrupts
        * Issued by I/O devices
        * Maskable can be in either masked or unmasked
        * Masked interrupts are ignored by the control unit as long as it is masked 
    * Nonmaskable interrupts
        * Critical events lead to nonmaskable interrupts
        * Always recognized by CPU
* Exceptions
    * Processor-detected exceptions
        * CPU detects anomalous condition while executing an instruction
        * Further divided into 3 groups
        * Stored on the eip register
    * Faults
        * Can be corrected
        * Program can resume with continuity
        * eip register has the saved value of the instruction that caused the fault
        * Will resume that instruction after the handler terminates
    * Traps
        * Reported immediately after trapped instruction
        * Kernel returns control and allows execution to continue
        * eip register holds the address of instruction to execute
            * Generally after the instruction that caused the trap
        * Traps are mostly for debugging purposes
            * Signal exists to notify the debugger that a specific instruction has been executed
    * Aborts
        * Serious error occurred and control unit is in trouble
        * May not have opportunity to store location causing the exception in the eip register
        * Report severe errors, like hardware failures and inconsistent values in system tables
        * Emergency signal gets sent to abort exception handler
        * Forcesd affected process to terminate
    * Programmed Exceptions
        * Occur at request of programmer
        * Handled as traps
        * Usually for system calls and to notify debugger of some event





